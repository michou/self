<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Mocking the real world for fun and profit</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/white.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/atom-one-light.css">

		<link href="https://fonts.googleapis.com/css?family=Fira+Mono" rel="stylesheet">

		<script src="//twemoji.maxcdn.com/2/twemoji.min.js?2.3.0"></script>

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
		<style>
		img.emoji {
			border: none !important;
			box-shadow: none !important;
			
			height: 1em;
			width: 1em;
			
			margin: 0 .05em 0 .1em !important;
			vertical-align: -0.1em;
		}
		.reveal p {
			text-align: left;
		}
		blockquote.wikipedia-mocking {
			font-style: normal;
			font-size: 85%;
			width: 80%;
			text-align: left;
			background-color: rgba(200, 200, 200, 0.65);
			padding: 0.5em;
			border-left: 1em rgba(100, 100, 100, 0.4) solid;
		}
		blockquote.wikipedia-mocking footer{
			font-style: italic;
			font-size: 70%;
		}
		.left-pad {
			padding-left: 1em !important;
		}
		code {
			font-family: 'Fira Mono', monospace !important;
		}

		p code {
			color: rgb(96, 96, 96);
		}

		span.dense {
			font-size: 80%;
			color: rgb(96, 96, 96);
		}

		.dense p,
		.dense li,
		.dense pre code {
			font-size: 90%;
		}

		.denser p,
		.denser li,
		.denser pre code {
			font-size: 80%;
		}
		</style>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h1>Mocking the real world for fun and profit</h1>
					<p style="text-align: right;">&mdash; Mihai Balan, QE Dev @ Adobe Identity</p>
					<aside class="notes" data-markdown>
Hi,
I'm Mihai Balan and I'm a QE Developer (or Software Engineer in Test as everybody else seems to be
calling it) in the Identity group here in Adobe. Tonight I want to tell you a couple of real-world
stories about how we used mocking for a lot more than just unit testing. And I know it's a big no-no
to mention that before the presentation, but I'm also eager to hear your own stories over pizza and
beer afterwards.
					</aside>
				</section>
				<section data-background="img/mocking/hands.jpg">
					<aside class="notes" data-markdown="">
Before we begin proper, a short show of hands &ndash; is there anyone here that **never** _used_ mocking when testing a product / service / whatever you're testing?
					</aside>
				</section>
				<section data-background="img/mocking/dummy.jpg">
					<blockquote class="wikipedia-mocking">
						In <strong class="fragment highlight-blue">object-oriented programming</strong>, mock objects are simulated objects that <span class="fragment highlight-blue">mimic the behavior of real objects in controlled ways</span>. A programmer typically creates a mock object to test the behavior of some other object, in much the same way that a car designer uses <span class="fragment highlight-red">a crash test dummy</span> to simulate the dynamic behavior of a human in vehicle impacts.
						<footer>
							&mdash; Wikipedia <sup class="fragment">[citation needed]</sup>
						</footer>
					</blockquote>
					<aside class="notes" data-markdown>
That definition is restrictive enough (it's OOP only, programmer-only, car-crushing-impact-only)

But if you think about it, we use "almost-but-not-quite-real" objects all the time when testing &ndash;
be it mock test data, that barely passes the validations, mock credit card numbers, dummy test files
and so on.
					</aside>
				</section>
				<section>
					<h2>Stories of mocking</h2>
					<ol>
						<li class="fragment">📔 The mocking textbook 101</li>
						<li class="fragment">🤪 &ldquo;When I&rsquo;m alone at night, I Google myself&rdquo;</li>
						<li class="fragment">📵 &ldquo;Nu răspunzi la SMS&rdquo;</li>
					</ol>
					<aside class="notes" data-markdown>
With the next 3 stories, I'm going to try and convince you (in case I already didn't), that mocking
can be used in a lot of places and that doing so is really worth it &ndash; both for your products'
qulity and, sometimes, for your own self-esteem as well.

I gave each of my stories a title...
					</aside>
				</section>
				<section>
					<section>
						<h2>📔 Textbook mocking</h2>
						<p class="fragment">OOP and polymorphism make it easy to swap components as long as they preserve the interface</p>
						<p class="fragment">DI makes it even easier, by decoupling resource usage and creation<br>
							<span class="left-pad">&ndash; some solutions can even hotswap</span>
						</p>
					</section>
					<section>
						<h2>📔 The system under test</h2>
						<p>
							Brand new micro-service, built with<br>
							<span class="left-pad"><strong>☕ Java</strong> <span style="display: inline-block;" class="fragment fade-up">OOP all the things!</span><br></span>
							<span class="left-pad"><strong>🍃 Spring</strong> <span style="display: inline-block;" class="fragment fade-up">DI all the things!</span></span>
						</p>
						<p class="fragment">
							External dependencies:<br>
							<span class="left-pad">🐬 Database (MySQL)<br></span>
							<span class="left-pad">📑 Persistent cache (Redis)<br></span>
							<span class="left-pad">🗄 Logging<br></span>
							<em>etc.</em>
						</p>
					</section>
					<section>
						<h2>📔 Integration testing in the small</h2>
						<p>Tests multiple components in concert</p>
						<p>Lighter-weight than full-blown integration tests</p>
						<div class="left-pad dense fragment">
							<p>No network involved</p>
							<p>No need to boot-up the app server</p>
						</div>
						<p class="fragment">Spring-supported, developers-approved 🤑</p>
					</section>
					<section>
						<h2>📔 Integration testing in the small &ndash; in practice</h2>
						<p>Mock what you don&rsquo;t care about with <code>Mockito</code>, mock shallowly what you do care about</p>
						<p>Use <code>MockMVC</code> to simulate requests to your endpoints and get the responses</p>
					</section>
					<section>
						<h2>📔 Integration testing in the small &ndash; in practice</h2>
						<div class="denser">
						<pre><code class="java">//The declaration in the micro service
@Autowired
private CacheService redisCache;
&hellip;
// Somewhere else, in a file far away &ndash; our mock "Redis"
@Service
public class ExpiringMapCacheService implements CacheService {
    private final Map&lt;CacheKey, ExpirableValue&gt; map =
        Collections.synchronizedMap(
            new PassiveExpiringMap&lt;&gt;((key, value) -&gt; value.expire)
        );

    @Override
    public &lt;T&gt; T get(CacheKey key) { &hellip; }
    // and all the other methods a respectable CacheService has
}</code></pre>
						</div>
					</section>
					<section>
						<h2>📔 Was it worth it?</h2>
						<p>We caught some timing-sensitive bugs</p>
						<p>We expanded the build-time test suite</p>
						<p>Easier debugging for failing tests<br>
							<span class="left-pad fragment">✨ happy developers ✨</span></p>
					</section>
				</section>
				<section>
					<section>
						<h2>🤪 When I&rsquo;m alone at night, I Google myself</h2>
						<p class="fragment">Add support for logging in with social accounts</p>
						<p class="fragment">First implemented Facebook support<br>
							<span class="left-pad fragment">💖 MUCH TESTING FRIENDLY. SUCH WOW</span><br>
							<span class="left-pad fragment">😿 SUCH SLOW. MUCH FLAKY</span>
						</p>
						<p class="fragment">Now add Google too <span class="fragment">😱</span></p>
					</section>
					<section>
						<h2>🤪 Can we test Google?</h2>
						<p>No way to create test accounts<br>
							<span class="fragment left-pad">&ndash; without a real phone number behind them</span>
						</p>
						<p>Difficult to automate login from AWS<br>
							<span class="fragment left-pad">&ndash; unless you still have that phone number</span>
						</p>
						<p>Some tests need fresh, never-before-seen users<br>
							<span class="fragment left-pad">&ndash; CI, baby! 🔴🔵</span>
						</p>
					</section>
					<section data-background="img/mocking/susi.png">
					</section>
					<section data-background="img/mocking/google.png"></section>
					<section>
						<h2>🤪 How did we do it?</h2>
						<p class="fragment">🐍 + AWS = 👍</p>
						<p class="fragment">Reverse engineer the APIs</p>
						<p class="fragment">Reverse engineer the UI <span class="fragment">🤔</span></p>
						<p class="fragment">Configurable Google endpoints</p>
					</section>
					<section>
						<h2>🤪 Was it worth it?</h2>
						<p>We were able to test!</p>
						<p>Easier debugging while developing the feature</p>
						<p>Decreased test run times</p>
						<p class="fragment">Fun! 🐍</p>
					</section>
				</section>
				<section>
					<section>
						<h2>📵 Nu răspunzi la SMS</h2>
						<p class="fragment">Add option to reset password via text message</p>
						<p class="fragment">Provider had a <em>staging</em> environment for feature development</p>
						<p class="fragment">Need to do performance testing on our side of the service <span class="fragment">💸💸💸</span></p>
					</section>
					<section data-background="img/mocking/phone-recovery.png"></section>
					<section>
						<h2>📵 Performance testing gotchas</h2>
						<p>Provider&rsquo;s staging environment<br>
							<span class="left-pad fragment">&ndash; not fast enough</span></p>
						<p><code>NOP</code>-ing the calls to the external services<br>
							<span class="left-pad fragment">&ndash; not an option</span></p>
						<p>Don&rsquo;t break the bank<br>
							<span class="left-pad fragment">&ndash; if at all possible</span></p>
					</section>
					<section>
						<h2>📵 A mock was born</h2>
						<p class="fragment">☕ Java, 🍃 Spring, and not much else</p>
						<p class="fragment">Deployed on AWS, accessible over the Internet</p>
						<p class="fragment">Exposing same API, but always returning success</p>
						<p class="fragment">Product code was already instrumented</p>
						<p class="fragment">🤖 + 🤖 = 💪</p>
					</section>
					<section>
						<h2>📵 Was it worth it?</h2>
						<p>Very 💰💰💰 much</p>
						<p>
							<span style="padding: 0 0.2em; display: inline-block; border: 1px solid lightgreen; background: green; color: white; border-radius: 3px;">
								+100 XP
							</span> for our DevOps skills
						</p>
						<p>Paved the way for other creative mocks</p>
					</section>
				</section>
				<section>
					<h2>Closing remarks</h2>
					<p>🔧 Mocking can be used in many situations</p>
					<p>💻 Being able to use mocking might require developer effort<br>
						<span class="dense left-pad">&ndash; don&rsquo;t think just about mocking, but <em>testability</em> in general</span>
					</p>
					<p>🚲 Don&rsquo;t reinvent the wheel; unless it&rsquo;s cheaper</p>
				</section>
				<section>
					<h1>Thank you!</h1>
				</section>
				<section>
					<h2>Colophon</h2>
					<p>Built with ♥ in Sublime Text, using <a href="https://lab.hakim.se/reveal">reveal.js</a></p>
					<p>Dummy from <a href="https://www.flickr.com/photos/mompl/9116330633/">mompl</a> on flickr</p>
					<p>Hands from <a href="https://www.flickr.com/photos/bylauryn/13019005805/">Lauryn</a> on flickr</p>
					<p>Emojis playfully injected using ✨<a href="https://github.com/twitter/twemoji">twEmoji</a>✨</p>
				</section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				backgroundTransition: 'slide',
				history: true,
				progress: false,
				overview: false,
				transition: 'slide',
				width: 800,
				height: 600,

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
			Reveal.addEventListener('ready', function(event) {
				Reveal.configure({ showNotes: Reveal.getQueryHash()['showNotes'] });
			});
			
			document.addEventListener('DOMContentLoaded', function(event) {
				console.log(event);
				twemoji.parse(document.body);
			});
		</script>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-68119344-2', 'auto');ga('send', 'pageview');
</script>
	</body>
</html>
